---
layout: post
title: "accdb の 醜い csv インポート"
description: ""
category: windows
tags: [accdb, csv]
---
{% include JB/setup %}

#### Micro$oft 嫌いです


#### ことの起こり

客先のツールをアクセスなる DB まがいで作成することに。

外部から CSV 形式でデータが送られて来て、
それを accdb にインポートするのだが、
エラーが出たので調査。

#### データタイプの自動判定

と、どうも、CSV からごっそりインポートする場合、
各フィールドのデータタイプが分からないため、
先頭の数レコードからデータタイプを判定するそうな。  
(Micro$oft は、「先頭 25 レコードには、データタイプを混在するな!」とか
言っている)

で、今回の CSV では、あるフィールドに入るデータの先頭幾つかに数字があり、
そのフィールドのデータタイプを INT と判断したようで、
その後に続く文字列を「型が違う」と思って、捨ててしまったよう。

* こんな CSV

|...|...| ここ |...|
|:--|:--|:--|:--|
|aa1|bb1|1111|dd1|
|aa2|bb2|2222|dd2|
|aa3|bb3|3333|dd3|
|aa4|bb4|4444|dd4|
|aa5|bb5|5555|dd5|
|aa6|bb6|6666|dd6|
|aa7|bb7|なな|dd7|
|aa8|bb8|はち|dd8|
|aa9|bb9|9999|dd9|

* 結果こうなる

|...|...| ここ |...|
|:--|:--|:--|:--|
|aa1|bb1|1111|dd1|
|aa2|bb2|2222|dd2|
|aa3|bb3|3333|dd3|
|aa4|bb4|4444|dd4|
|aa5|bb5|5555|dd5|
|aa6|bb6|6666|dd6|
|aa7|bb7| |dd7|
|aa8|bb8| |dd8|
|aa9|bb9|9999|dd9|


#### テーブル定義しておこう

なので、事前に accdb にカラのテーブルを作成し、そのフィールドをテキス
ト型に指定し、CSV のデータをレコードの追加としてインポートするように変
更。

|...|...| ここ(TEXT) |...|
|:--|:--|:--|:--|

これで数字も文字列もテキスト型となるので安心...  
と思ったが、

#### しかしダメ

しかし、結果は一緒で、数字はインポートできるが、文字列は捨てられてしま
うことに。

ううむ、どうも、accdb のテーブル定義での型とは無関係に、まずは、先頭数
レコードでデータタイプを判定し、それに合わないものは捨てて、その後、生
き残ったものをテーブルのデータタイプに合わせて変換している様子。

#### なんだかなぁ

結局、対策としては、テキストの場合は CSV データを "1111" とかしないと
ダメらしい。

#### もちょっと考えてよ!

##### データタイプ指定

* テーブル定義で型指定あるのなら、その型で読み込んでよ。

##### 自動判定

* 先頭 25 レコードで自動判定するのは良いが、であれば、一番データを取
   り込める型(今回の場合はテキスト)を優先してよ。
* たとえ INT データを TEXT で読み込んでも、まずは accdb に取り込めれば、
  あとは何とでもなる。
* 現状だと、 **文字列データがなくなってしまう** ( accdb に取り込めない)こ
  とが最大の問題。


頭悪い。所詮オモチャ。

